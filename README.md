# ΕΡΓΑΣΙΑ ΑΝΑΠΤΥΞΗ ΛΟΓΙΣΜΙΚΟΥ ΓΙΑ ΔΙΚΤΥΑ ΚΑΙ ΤΗΛΕΠΙΚΟΙΝΩΝΙΕΣ

Φεβρουάριος 2025

Ιωάννης Ζερμπίνος		Α.Μ.: 1115202000053

Χαράλαμπος Κυρίτσης 	Α.Μ.: 1115201600080

Βασίλειος Σωνάκης 		Α.Μ.: 1115202100179 

Παντελεήμων Χατζηπέτρου	Α.Μ.: 1115202100215






# EDGE SERVER

### Σταθερές και Μεταβλητές
BROKER_URL: Η διεύθυνση του MQTT broker.
TOPIC_SUB_ANDROID_APP, TOPIC_SUB_IOT1, TOPIC_SUB_IOT2: Τα topics που ακούει ο server.
TOPIC_PUB_ANDROID_APP, TOPIC_PUB_JS1, TOPIC_PUB_JS2, TOPIC_PUB_ANDROID_JS: Τα topics στα οποία δημοσιεύει ο server.
CLIENT_ID: Ένα μοναδικό αναγνωριστικό για τον MQTT client.
lat1, lon1, lat2a, lon2a, lat2b, lon2b, distance: Γεωγραφικά δεδομένα και η απόσταση μεταξύ τους.
eventOD1, eventGas1 κτλ.: Flags που δηλώνουν αν έχουν εντοπιστεί συμβάντα για διαφορετικούς αισθητήρες.
measurement: Μέτρηση από έναν αισθητήρα.
keepRunning: Χρησιμοποιείται για τη διατήρηση του loop λειτουργίας του server.


### main Μέθοδος
Εκκίνηση Server: Η μέθοδος serverStart ξεκινάει τον MQTT client σε ξεχωριστό thread.
Χειρισμός Εισόδου Χρήστη: Το πρόγραμμα περιμένει από τον χρήστη να πατήσει Enter για να σταματήσει ο server (keepRunning = false).
Αποσύνδεση: Όταν ο χρήστης δώσει το σήμα, ο server αποσυνδέεται από τον broker.


### serverStart Μέθοδος
Εκκινεί ένα νέο thread για να χειριστεί τον server.
Συνδέεται στον MQTT broker και κάνει subscribe στα topics TOPIC_SUB_ANDROID_APP, TOPIC_SUB_IOT1, και TOPIC_SUB_IOT2.
Ο server συνεχίζει να λειτουργεί όσο η μεταβλητή keepRunning είναι true.


### getMqttClient Μέθοδος
Δημιουργεί και επιστρέφει έναν MqttClient.
Καθορίζει έναν callback handler που:
connectionLost: Αντιμετωπίζει την απώλεια σύνδεσης με το broker.
messageArrived: Επεξεργάζεται μηνύματα που λαμβάνονται από διαφορετικά topics.
deliveryComplete: Επιβεβαιώνει ότι ένα μήνυμα έχει παραδοθεί.


### Επεξεργασία Δεδομένων από Topics
i. TOPIC_SUB_ANDROID_APP
Επεξεργάζεται δεδομένα που περιλαμβάνουν:
deviceID: Αναγνωριστικό συσκευής.
lat1 και lon1: Συντεταγμένες.
Εμφανίζει τα δεδομένα στην κονσόλα.
ii. TOPIC_SUB_IOT1 και TOPIC_SUB_IOT2
Επεξεργάζεται δεδομένα από αισθητήρες.
Τα δεδομένα περιλαμβάνουν:
Συντεταγμένες (lat2a, lon2a ή lat2b, lon2b).
Ζεύγη "αισθητήρας - μέτρηση" (π.χ., OD 0.2).
Οι αισθητήρες που ελέγχονται είναι:
OD (Optical Density)
GAS
TEMP
UV
Ελέγχει αν οι μετρήσεις είναι έγκυρες και αν ξεπερνούν κάποια thresholds, για να εντοπίσει events.


### Υπολογισμός Απόστασης και Επιπέδου Κινδύνου
Υπολογίζει την απόσταση μεταξύ του χρήστη (lat1, lon1) και του σημείου του συμβάντος (lat2a, lon2a ή lat2b, lon2b).
Υπολογίζει ένα "risk level" (High, Moderate) ανάλογα με τα ενεργά συμβάντα.
Δημοσιεύει μήνυμα στο TOPIC_PUB_ANDROID_APP με το επίπεδο κινδύνου και την απόσταση.
Καταγράφει τα δεδομένα στη βάση μέσω της DatabaseConnection.
Δημοσιεύονται τα δύο μηνύματα στο frontend του server που χρειάζονται για την οπτικοποίηση δεδομένων.
Άλλες Παρατηρήσεις
• Ο server τρέχει σε ξεχωριστό thread, επιτρέποντας ασύγχρονη λειτουργία.
• Μπορεί να επεξεργάζεται δεδομένα από διαφορετικούς αισθητήρες και να προσαρμόζεται στις απαιτήσεις κάθε topic.






# ANDROID APP

Αρχικά, υπάρχουν 4 κλάσεις που χωρίζουν τις δουλειές του Android app:

MainActivity
ManualMode
NetworkChecking
XmlToCsvConverter

### MainActivity
Ξεκινάω στο MainActivity με τον ορισμό διάφορων μεταβλητών που θα χρησιμοποιήσω μέσα σε αρκετές μεθόδους, επομένως πρέπει το scope να είναι σε όλο το αρχείο.

Στην onCreate() ξεκινάω με αρχικοποίηση του menu toolbar, που περιέχει το item Manual Mode (νέο activity) και Exit, που σε βγάζει από την εφαρμογή.

Έπειτα, χρησιμοποιώ την getIntExtra() για να περάσω τη μεταβλητή manual_mode_seconds από το άλλο activity σε αυτό. Αν η συνάρτηση δεν βρει το key SECONDS_KEY, τότε βάζει ως default τιμή το 0.

Επόμενο βήμα είναι η κλήση της LocationServices.getFusedLocationProviderClient(this), η οποία περνιέται στη μεταβλητή fusedLocationClient και δρα σαν location provider για τα GPS δεδομένα της συσκευής σε περίπτωση αυτόματου ελέγχου για την τοποθεσία.

Μετά καλείται η setupLocationCallback(), η οποία κάνει set ένα LocationCallback() για να δέχεται ασύγχρονα updates στην τοποθεσία όσο κινείται η συσκευή στον χώρο.

Έπειτα, καλείται η checkLocationPermission(), η οποία ελέγχει αν υπάρχουν τα απαραίτητα permissions. Αν δεν υπάρχουν, ρωτάει τον χρήστη για την ενεργοποίησή τους, αλλιώς καλεί την getLocation(), η οποία ενημερώνει την τοποθεσία.

Επιπλέον, υπάρχουν και άλλες 3 συναρτήσεις callbacks για την τοποθεσία:

onRequestPermissionResult(), που ελέγχει αν έχει γίνει αποδεκτό το permission, αλλιώς εμφανίζει ένα toast message.
onResume(), όπου συνεχίζει τα location updates.
onPause(), όπου τα σταματάει, αν π.χ. αλλάξει το Activity.
Γυρνώντας πίσω στην onCreate(), αρχικοποιείται ο networkMonitor και καλείται η startChecking(), η οποία ελέγχει συνεχώς αν ο χρήστης είναι online. Αν δεν είναι, του εμφανίζει ένα μήνυμα που τον παραπέμπει στις ρυθμίσεις για να το ενεργοποιήσει.

Στη συνέχεια, καλείται η random.nextInt(), όπου επιλέγεται τυχαία ο αριθμός 0 ή 1, για την τυχαία επιλογή του XML αρχείου για την τοποθεσία manually.

Αφού επιλεγεί το αρχείο τυχαία, καλείται η convertXmltoCsv(), που δημιουργεί ένα αρχείο CSV και κάνει append τα δεδομένα που θέλουμε από το XML (θα αναλυθεί παρακάτω).

Έπειτα, αρχικοποιείται το mySwitch(), που δίνει στον χρήστη τη δυνατότητα να επιλέξει αν η αποστολή δεδομένων θα γίνει manually ή automatic. Έτσι όπως έχει υλοποιηθεί, ο χρήστης ανά πάσα στιγμή μπορεί να αλλάξει τον τρόπο αποστολής.

Πρακτικά, ο setOnCheckedListener() του switch κάνει το εξής: Υπάρχουν 2 threads runnables που εκτελούν τις διαφορετικές δουλειές. Το ένα στέλνει manually, το άλλο αυτόματα.

Η λογική είναι η εξής:

Αν το switch είναι checked, σταματά το csvPublishRunnable και ξεκινά το automaticPublishRunnable.
Αν δεν είναι checked, γίνεται το αντίστροφο.
Προεπιλεγμένη επιλογή είναι το switch να είναι checked.
Στην onCreateOptionsMenu() απλά υπάρχει η ενέργεια να γίνεται inflate το menu, μόλις ο χρήστης πατήσει τις τρεις τελείες πάνω δεξιά.

Η connectClicked() κάνει τη βασικότερη δουλειά για τη MQTT σύνδεση. Αρχικά, παίρνω τα δεδομένα που τοποθετεί ο χρήστης στα EditTexts ipAddress και portString και ελέγχω αν δεν είναι empty.

Αν δεν είναι, τσεκάρω αν ο χρήστης έχει δώσει σωστό αριθμό port (από 1 μέχρι 65535, που είναι ο μέγιστος αριθμός διαθέσιμων ports).

Αν περάσει και αυτόν τον έλεγχο, τότε δημιουργώ το τελικό URL με τον εξής τρόπο:
"tcp://" + ipAddress + ":" + portNumber

Έπειτα, ξεκινάω ένα UiThread() (για να σιγουρευτούμε ότι οι αλλαγές στο UI θα γίνουν από το main UI thread), όπου θα κάνει set το connection.

Μέσα στο try clause κάνω set τις options, δημιουργώ ένα randomID για τον client και κάνω set τα callbacks για το MQTT service.

Τα callbacks είναι τα εξής:

connectionLost() → εμφανίζει μήνυμα αν χαθεί η σύνδεση.
deliveryComplete() → δεν κάνει τίποτα, αλλά αφού προϋπήρχε, το άφησα εκεί.
messageArrived() → δέχεται το μήνυμα από ένα topic στο οποίο είναι subscribed η συσκευή, κάνει split τα δεδομένα σε riskLevel και distance (έχει γίνει σύμβαση ότι έτσι θα έρχονται από τον server) και καλεί την handleRiskAlert(riskLevel, distance), που με τη σειρά της καλεί τη showAlert(), η οποία setάρει και εμφανίζει ειδοποιήσεις σε περίπτωση event.
Αφού γίνει η σύνδεση, εμφανίζεται ένα μήνυμα και το Android κάνει subscribe στο topic του server για να δέχεται μηνύματα.

Έπειτα, καλείται η startLocationPublishing(), η οποία κάνει όλη τη δουλειά publish των δεδομένων. Ξεκινάει δύο runnables (που τρέχουν κάθε ένα δευτερόλεπτο), τα οποία καλούν την αντίστοιχη συνάρτηση για publish των δεδομένων, με τη λογική που εξηγήθηκε πριν στο switch.

Το automaticPublishRunnable καλεί την publishCoordinates(), που απλά κάνει publish τα δεδομένα.
Το csvPublishRunnable καλεί πρώτα την publishFromCsvFile(), που διαβάζει γραμμή-γραμμή το CSV αρχείο, κάνει extract τις τιμές x και y, και στη συνέχεια καλεί την publishCoordinates() για να στείλει τις συντεταγμένες και το deviceID.
Τέλος, στο MainActivity class υπάρχει και η disconnectClicked(), η οποία τερματίζει τα runnables και τη σύνδεση με τον MQTT broker.

### ManualMode
Δεύτερο activity, προσβάσιμο από το menu αν ο χρήστης έχει επιλέξει publish με CSV. Επιλέγεται πόσα δευτερόλεπτα και δείγματα θα σταλούν manually. Όταν πατήσει set, η getIntent().getIntExtra() επιστρέφει την τιμή στο MainActivity.

### NetworkChecking
Δημιουργείται ένας handler, ο οποίος τσεκάρει κάθε 10.000 ms αν υπάρχει σύνδεση στο δίκτυο. Αν όχι, εμφανίζει ειδοποίηση και παραπέμπει τον χρήστη να συνδεθεί στο internet.

### XmlToCsvConverter
Γίνεται όλη η δουλειά του conversion από XML σε CSV, χρησιμοποιώντας τις δυνατότητες του XmlFullParser.


# IOT APP


## Περιγραφή

Η εφαρμογή Android που αναπτύχθηκε επιτρέπει την παρακολούθηση και αποστολή δεδομένων αισθητήρων μέσω πρωτοκόλλου MQTT. Υποστηρίζει διαφορετικούς τύπους αισθητήρων, συνδέεται με τον Edge Server και αποστέλλει δεδομένα όπως γεωγραφικές συντεταγμένες, τύπος και τιμές αισθητήρων, επίπεδα μπαταρίας και το αναγνωριστικό συσκευής.


## Περιγραφή Συναρτήσεων

### MainActivity

onCreate(Bundle savedInstanceState)
Αρχικοποιεί το περιβάλλον χρήστη.
Ρυθμίζει τη γραμμή εργαλείων και τις καρτέλες.
Ελέγχει αν υπάρχουν αποθηκευμένες χειροκίνητες συντεταγμένες.
Ξεκινά την παρακολούθηση του δικτύου και της μπαταρίας.
Ρυθμίζει τον διακόπτη GPS για εναλλαγή μεταξύ αυτόματης και χειροκίνητης λειτουργίας.

setManualCoordinates()
Επιλέγει τυχαίες συντεταγμένες από ένα προκαθορισμένο σύνολο που δίνεται.
Ενημερώνει τις τιμές latitude και longitude.

connectClicked(View view)
Ελέγχει αν η IP και η θύρα έχουν εισαχθεί σωστά.
Συνδέεται στον Edge Server και ρυθμίζει callbacks για ειδοποιήσεις σύνδεσης.
Ξεκινά την αποστολή δεδομένων τοποθεσίας.

disconnectClicked(View view)
Αποσυνδέει την I.O.T. συσκευή από τον Edge Server.
Σταματά όλες τις προγραμματισμένες αποστολές δεδομένων.

publishData()
Ελέγχει αν η I.O.T. συσκευή είναι συνδεδεμένη.
Παίρνει τις συντεταγμένες GPS της συσκευής ή αυτές που δίνονται χειροκίνητα.
Συντάσσει μήνυμα με τις ανωτέρω συντεταγμένες, τους τύπους και τις τιμές των αισθητήρων, το ποσοστό της μπαταρίας και το αναγνωριστικό της συσκευής και το στέλνει μέσω MQTT.

checkLocationPermission()
Ελέγχει αν έχουν δοθεί δικαιώματα τοποθεσίας.
Ζητά δικαιώματα αν δεν έχουν δοθεί.

getLocation()
Ανακτά τις τρέχουσες συντεταγμένες GPS αν η αυτόματη λειτουργία είναι ενεργή.
Χρησιμοποιεί το FusedLocationProviderClient για ακριβή αποτελέσματα.

startLocationUpdates() / stopLocationUpdates()
Ξεκινά ή σταματά την ενημέρωση τοποθεσίας σε πραγματικό χρόνο.

startBatteryMonitoring() / sendBatteryPercentageToMQTT()
Ελέγχει και αποστέλλει το ποσοστό μπαταρίας στη συσκευή ανά τακτά χρονικά διαστήματα.

showManualCoordinateDialog()
Εμφανίζει διάλογο για εισαγωγή χειροκίνητων συντεταγμένων από τον χρήστη.
Ελέγχει αν οι τιμές που εισάγονται είναι έγκυρες.

showNewSensorDialog()
Εμφανίζει διάλογο για προσθήκη νέου αισθητήρα.
Επιτρέπει στον χρήστη να εισάγει τύπο και εύρος τιμών.
Ελέγχει αν ο τύπος και οι τιμές είναι έγκυρες.
Προσθέτει νέο fragment για τον αισθητήρα.

updateSensorValue(String type, double value)
Ενημερώνει τη λίστα ενεργών αισθητήρων με νέες τιμές.
Καταγράφει την ενημέρωση στο log.

onSmokeSensorValueChanged(double value), onGasSensorValueChanged(double value), onUvSensorValueChanged(double value), onTempSensorValueChanged(double value)
Λαμβάνουν νέες τιμές από τους αισθητήρες και τις ενημερώνουν στη λίστα δεδομένων.

showSettingsDialog()
Επιτρέπει στον χρήστη να εισάγει IP, θύρα και να επιλέξει MQTT topic.
Συνδέεται στον Edge Server με τις νέες ρυθμίσεις.

handleBackPress() / showExitConfirmationDialog() / killApp()
Διαχειρίζεται την έξοδο από την εφαρμογή.
Αν ο χρήστης πατήσει δύο φορές το Back Button σε σύντομο διάστημα, εμφανίζεται διάλογος επιβεβαίωσης εξόδου.
Κλείνει πλήρως την εφαρμογή και τερματίζει όλες τις διεργασίες.

### VPAdapter

VPAdapter(FragmentActivity fragmentActivity)
Κατασκευαστής που αρχικοποιεί το adapter, προσθέτει τους προεπιλεγμένους αισθητήρες και διαχειρίζεται την εναλλαγή μεταξύ των διαφορετικών fragments σε διαφορετικές οθόνες. Επιπλέον, παρέχει την δυνατότητα προσθήκης νέου fragment.

### Manual Mode

onCreate(Bundle savedInstanceState)
Είναι μία κλάση η οποία επιτρέπει την εισαγωγή συντεταγμένων με χειροκίνητο τρόπο. Εμφανίζονται δύο πεδία,latitude και longitude, τα οποία καλείται να συμπληρώσει ο χρήστης με προσοχή καθώς υπάρχουν περιορισμοί στις τιμές αυτών. Αφού τα συμπληρώσει, αυτά αποστέλλονται στην MainActivity, η οποία εμφανίζει μήνυμα επιβεβαίωσης. 

### NetworkChecking

Η κλάση NetworkChecking παρακολουθεί την κατάσταση της σύνδεσης στην I.O.T εφαρμογή. Συγκεκριμένα, η μέθοδος startChecking, ξεκινά την περιοδική παρακολούθηση της σύνδεσης εκτελώντας το checkNetworkRunnable. Αυτό, κάθε δέκα δευτερόλεπτα, ελέγχει αν υπάρχει ακόμα ενεργή σύνδεση στο δίκτυο. Σε περίπτωση που δεν υπάρχει, εμφανίζει κατάλληλο μήνυμα που ζητά από τον χρήστη να ενεργοποιήσει την σύνδεση μέσω Wi-fi ή Mobile Data ρυθμίσεων.

### gas_fragment / smoke_fragment / temp_fragment / uv_fragment

Είναι ένα fragment που προσομοιώνει τον αντίστοιχο αισθητήρα. Επιτρέπει στον χρήστη να ρυθμίζει την τιμή του αισθητήρα μέσω ενός SeekBar και να ενεργοποιεί ή να απενεργοποιεί την αποστολή δεδομένων του αισθητήρα με την χρήση Button. Σε περίπτωση που η τιμή υπερβεί μια συγκεκριμένη τιμή, αυτή αλλάζει χρώμα ως ένδειξη κινδύνου. Όταν ο αισθητήρας είναι ενεργοποιημένος, η τιμή του αποστέλλεται στο MainActivity κάθε ένα δευτερόλεπτο.


## Τρόπος Λειτουργίας της Εφαρμογής

Η εφαρμογή επιτρέπει στον χρήστη να:
Συνδέεται στον Edge Server εισάγοντας IP και θύρα.
Επιλέγει ένα από τα διαθέσιμα MQTT topic για αποστολή δεδομένων.
Ενεργοποιεί ή απενεργοποιεί το GPS ώστε να λαμβάνει αυτόματα ή χειροκίνητα τις συντεταγμένες της συσκευής.
Εάν το GPS είναι απενεργοποιημένο, προεπιλεγμένα χρησιμοποιούνται τυχαίες συντεταγμένες από το Τμήμα Πληροφορικής και Τηλεπικοινωνιών του Εθνικού και Καποδιστριακού Πανεπιστημίου Αθηνών, ενώ ταυτόχρονα δίνει την δυνατότητα στον χρήστη να εισάγει χειροκίνητα τις συντεταγμένες που θέλει αυτός.
Προσθέτει νέους αισθητήρες, εισάγοντας τύπο και εύρος τιμών σε αυτούς.
Παρακολουθεί το επίπεδο μπαταρίας της συσκευής και το αποστέλλει στον Edge Server.
Στέλνει σε πραγματικό χρόνο όλα τα παραπάνω δεδομένα (ποσοστό μπαταρίας, συντεταγμένες, τύπος αισθητήρα, τιμές αισθητήρα) στον Edge Server, μαζί με το αναγνωριστικό της συσκευής.

## Οδηγός Χρήσης

### Έναρξη της εφαρμογής

Κατά το άνοιγμα της εφαρμογής, εμφανίζεται μήνυμα μέσω του οποίου ζητείται από τον χρήστη άδεια για την πρόσβαση στην τοποθεσία της συσκευής. Έπειτα, εμφανίζεται η κύρια οθόνη με τις δύο καρτέλες των προεγκατεστημένων αισθητήρων και τον διακόπτη GPS. Σε περίπτωση προσθήκης νέου αισθητήρα από το μενού επιλογών, δημιουργείται μία νέα καρτέλα γι αυτόν. 

### Ενεργοποίηση/Απενεργοποίηση GPS

Ο διακόπτης GPS στην κύρια οθόνη επιτρέπει την εναλλαγή μεταξύ αυτόματης και χειροκίνητης λειτουργίας.
Όταν είναι ενεργοποιημένος, η συσκευή στέλνει αυτόματα τις συντεταγμένες, εφόσον έχει την κατάλληλη άδεια.
Όταν είναι απενεργοποιημένος, προεπιλεγμένα χρησιμοποιούνται τυχαίες συντεταγμένες από το Τμήμα Πληροφορικής και Τηλεπικοινωνιών του Εθνικού και Καποδιστριακού Πανεπιστημίου Αθηνών, ενώ ταυτόχρονα δίνει την δυνατότητα στον χρήστη να εισάγει χειροκίνητα τις συντεταγμένες που θέλει αυτός από το Μενού Ρυθμίσεων

### Μενού Επιλογών

Το μενού επιλογών που βρίσκεται πάνω δεξιά στην οθόνη αποτελείται από τέσσερις επιλογές: “New Sensor”, “Connection Settings”, “Manual Mode” και “Exit”.
New Sensor 
Από το μενού επιλογών, επιλέγοντας "New Sensor" ο χρήστης έχει την δυνατότητα να δημιουργήσει έναν νέο αισθητήρα. Συγκεκριμένα, καλείται να εισάγει τον τύπο του αισθητήρα και το εύρος τιμών. Οι τιμές που λαμβάνει ο αισθητήρας θα εμφανίζονται και θα αποστέλλονται στον Edge Server.

### Connection Settings

Από το μενού επιλογών, επιλέγοντας ”Connection Settings” ο χρήστης έχει την δυνατότητα να εισάγει τη διεύθυνση IP και τη θύρα προκειμένου να συνδεθεί στον Edge Server. Επιπλέον, θα πρέπει να επιλέξει ένα MQTT topic και να πατήσει "OK" για να συνδεθεί. Πατώντας το κουμπί “Cancel” η I.O.T. συσκευή αποσυνδέεται από τον Edge Server αν είναι ήδη συνδεδεμένη. 
Manual Mode
Από το μενού επιλογών, επιλέγοντας ”Manual Mode”, ο χρήστης έχει την δυνατότητα να εισάγει χειροκίνητα τις συντεταγμένες που θέλει αυτός, εφόσον έχει απενεργοποιήσει πρώτα την αυτόματη τοποθεσία από τον διακόπτη GPS στην κύρια οθόνη.

### Exit
Από το μενού επιλογών, επιλέγοντας “Exit”, ο χρήστης έχει την δυνατότητα να κλείσει την εφαρμογή πλήρως πατώντας “Yes” στο προειδοποιητικό μήνυμα που θα εμφανιστεί. Αυτή η δυνατότητα είναι διαθέσιμη και με το διπλό πάτημα του Back Button.


## Σημείωση
Η εφαρμογή στέλνει αυτόματα τις πληροφορίες τοποθεσίας, μπαταρίας και αισθητήρων κάθε 1 δευτερόλεπτο.
Σε περίπτωση αποσύνδεσης, τα δεδομένα σταματούν να αποστέλλονται.




# Web Interface

## Περιγραφή
Το γραφικό περιβάλλον που αναπτύχθηκε έχει σκοπό να οπτικοποιεί σε πραγματικό χρόνο τα δεδομένα των αισθητήρων (I.o.T)  και κινητών συσκευών πάνω στον χάρτη – google maps. Πιο συγκεκριμένα για τις IoT συσκευές περιλαμβάνει την τοποθεσία της κάθε συσκευής IoT, τα δεδομένα των αισθητήρων της καθώς και 3 διαφορετικά markers για αναπαράσταση του βαθμού επικινδυνότητας, ακόμα αν 2 αισθητήρες είναι ταυτόχρονα σε βαθμό επικινδυνότητας medium ή high σκιαγραφεί την μπλοκαρισμένη μεταξύ τους περιοχή. Όλα τα δεδομένα λαμβάνονται από τον Edge Server.

## Τρόπος Χρήσης
Ο χρήστης ανοίγει το index.html σε έναν εξυπηρετητή / browser.

## Περιγραφή Αρχείων και συναρτήσεων

### Index.html
Το αρχείο html που «τρέχει» ο χρήσης φορτώνει τα JavaScript scripts και την βασική CSS.
Το https://maps.googleapis.com/maps/api/js?key=, φορτώνει το google maps, το API και τις βιβλιοθήκες συναρτήσεών του, που παρέχονται από την Google. Περιέχει στο τέλος του ένα κλειδί που παρέχετε από την google και έχει συγκεκριμένα όρια χρήσης του API. 
Το https://unpkg.com/mqtt/dist/mqtt.min.js, φορτώνει τα έτοιμες βιβλιοθήκες  που χρειάζονται για την λειτουργεία του MQTT. 
Ακόμα τα data.js, info_marker_over.js, mqtt_fetch.js, είναι τα αρχεία που έχουν δημιουργηθεί από εμάς για να επιτευχθεί η προαναφερόμενη λειτουργικότητα.
Έπειτα στο body section εκκινούνε τα 2 βασικά scrips ώστε να φορτωθεί ο χάρτης και να ακούμε για μηνύματα με το MQTT.
 
### data.js
Στο αρχείο αυτό υπάρχουν οι συναρτήσεις που μετατρέπουν τα δεδομένα από το message string που στέλνονται με το MQTT σε Array με Properties(device_ID,Latitude,Battey κτλ) για να χρησιμοποιηθεί στις επόμενες functions. Στην περίπτωση των δεδομένων για τις IoT συσκευές που είναι πιο πολύπλοκα και συγκεκριμένα για τους αισθητήρες δημιουργείτε ένα εμφωλευμένο array  με δυναμικό μέγεθος γιατί δεν υπάρχει προκαθορισμένο πλήθος και είδος αισθητήρων. 

### mqtt_fetch.js
Στο αρχείο αυτό υπάρχουν οι συναρτήσεις που διαχειρίζονται την σύνδεση στον Mqtt broker καθώς και το κατάλληλο topic, ένα για την κινητή συσκευή και ένα topic για την κάθε IoT συσκευή, και ακούνε / περιμένουν για μήνυμα σε αυτά. Με το που φτάσει ένα μήνυμα σε κάποιο topic καλούνε την κατάλληλη συνάρτηση parseClientData / parseIoTData, για την μετατροπή των δεδομένων σε array και έπειτα καλούνε την συνάρτηση gmaps_client_overlay / gmaps_iot_overlay. 

### Info_marker_over.js
Σε αυτό το αρχείο υλοποιούνται όλες οι συναρτήσεις που δημιουργούν τα overlays πάνω στο google maps. 

initMap()
Γίνεται η φόρτωση και κεντράρισμα(σε προεπιλεγμένη τοποθεσία)  του google maps με την 

gmaps_iot_overlays()
Στην συγκεκριμένη συνάρτηση δημιουργείτε ή ανανεώνετε το Marker, το Circle ( κύκλος γύρο από το marker) και το Info Window για κάθε IoT συσκευή. Ακόμα αποθηκεύεται το πότε έτρεξε τελευταία φορά η συνάρτηση για να μπορεί αφαιρεθεί ή να γίνει ανενεργή η συσκευή σε περίπτωση που σταματήσουν να έρχονται δεδομένα για αυτή. Τέλος καλείτε η συνάρτηση που κατασκευάζει την περιοχή αποκλεισμού.  

gmaps_danger_zone_overlay()
Ελέγχει αν ικανοποιούνται οι συνθήκες και δημιουργεί το overlay για την περιοχή αποκλεισμού με όρια του παραλληλογράμμου λίγο έξω από τις συντεταγμένες των IoT συσκευών. Αν δεν ικανοποιούνται τα όρια αλλά υπάρχει το παραλληλόγραμμο (από προηγούμενη μέτρηση) το καταστρέφει. 

iot_deactivate()   &  iot_delete()
Θέτει την συσκευή ώς ανενεργή (κόκκινο κυκλάκι ) αν δεν έχει λάβει δεδομένα από αυτή για 3 δευτερόλεπτα, και αν δεν λάβει για 8 δευτερόλεπτα την διαγράφει εντελώς. Οι συναρτήσεις τρέχουν/ελέγχουν  ανά 2 δευτερόλεπτα.
danger_zone_overlay_cleanup()
Καταστρέφει ανά 5 δευτερόλεπτα το overlay της περιοχής αποκλεισμού, για περιπτώσεις που έχει σταματήσει να στέλνει δεδομένα ή έχει μετακινηθεί η IoT συσκευή.

gmaps_client_overlay()
Στην συγκεκριμένη συνάρτηση δημιουργείτε ή ανανεώνετε το Marker για την κινητή android συσκευή. Ακόμα αποθηκεύεται το πότε έτρεξε τελευταία φορά η συνάρτηση για να μπορεί αφαιρεθεί η συσκευή σε περίπτωση που σταματήσουν να έρχονται δεδομένα για αυτή.

client_cleanup()
Αφαιρεί την συσκευή/marker από τον χάρτη αν σταματήσουν να έρχονται δεδομένα για αυτή για 10 δευτερόλεπτα. Οι συνάρτηση τρέχει/ελέγχει ανά 2 δευτερόλεπτα.

*  Υπάρχουν αναλυτικά σχόλια σε κάθε συνάρτηση και βήμα/ γραμμή του κώδικα 


